<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/558ca1a6aa3cb55e-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/a45cd71e868d0a07.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-e7e2e9d366afa4de.js"/><script src="/_next/static/chunks/4bd1b696-7eaee204a5c142bf.js" async=""></script><script src="/_next/static/chunks/684-15f419a0a8eb14a6.js" async=""></script><script src="/_next/static/chunks/main-app-79e5b1a389d0fe5b.js" async=""></script><script src="/_next/static/chunks/874-f1885bdfe67c9a21.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bslug%5D/page-f9e0a1a25b6c6997.js" async=""></script><meta name="next-size-adjust" content=""/><title>DALL-E and a Combinatoric Collage | Michael Swift</title><meta name="description" content="generative image model collages"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="128x128"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_f9e569 antialiased font-mono bg-background text-foreground"><!--$--><div class="min-h-screen bg-background"><div class="max-w-4xl mx-auto px-6 py-12"><a class="inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground mb-8 transition-colors" href="/#posts"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left" aria-hidden="true"><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg>Back to posts</a><header class="mb-8"><div class="mb-4"><div class="text-sm uppercase text-muted-foreground mb-2">computer-vision</div><h1 class="text-4xl md:text-5xl font-serif font-bold leading-tight">DALL-E and a Combinatoric Collage</h1></div><div class="text-muted-foreground">May 26, 2023</div><div class="flex flex-wrap gap-2 mt-4"><span class="px-2 py-1 text-xs bg-secondary text-secondary-foreground rounded">computer-vision</span><span class="px-2 py-1 text-xs bg-secondary text-secondary-foreground rounded">generative-modeling</span><span class="px-2 py-1 text-xs bg-secondary text-secondary-foreground rounded">multimodal-ai</span><span class="px-2 py-1 text-xs bg-secondary text-secondary-foreground rounded">image-synthesis</span><span class="px-2 py-1 text-xs bg-secondary text-secondary-foreground rounded">diffusion-models</span><span class="px-2 py-1 text-xs bg-secondary text-secondary-foreground rounded">neural-networks</span><span class="px-2 py-1 text-xs bg-secondary text-secondary-foreground rounded">deep-learning</span></div></header><article class="prose prose-lg max-w-none  prose-headings:font-serif prose-headings:font-semibold prose-headings:text-foreground prose-h1:text-3xl prose-h1:md:text-4xl prose-h1:mb-6 prose-h1:mt-8 prose-h2:text-2xl prose-h2:md:text-3xl prose-h2:mb-4 prose-h2:mt-8 prose-h3:text-xl prose-h3:md:text-2xl prose-h3:mb-3 prose-h3:mt-6 prose-p:text-base prose-p:md:text-lg prose-p:leading-relaxed prose-p:mb-6 prose-p:font-serif prose-p:text-muted-foreground prose-strong:font-semibold prose-strong:text-foreground prose-a:text-primary prose-a:no-underline hover:prose-a:underline prose-ul:mb-6 prose-ul:space-y-2 prose-li:text-base prose-li:md:text-lg prose-li:font-serif prose-li:text-muted-foreground prose-ol:mb-6 prose-ol:space-y-2 prose-blockquote:border-l-4 prose-blockquote:border-primary prose-blockquote:pl-4 prose-blockquote:italic prose-blockquote:text-muted-foreground prose-code:bg-[#fdf6e3] prose-code:text-[#657b83] prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-sm prose-code:font-mono prose-code:border prose-code:border-[#eee8d5] prose-pre:bg-[#fdf6e3] prose-pre:text-[#657b83] prose-pre:p-4 prose-pre:rounded-lg prose-pre:overflow-x-auto prose-pre:border prose-pre:border-[#eee8d5] prose-pre:shadow-sm prose-pre:font-mono prose-pre:text-sm prose-pre:leading-relaxed [&amp;_.hljs]:bg-transparent [&amp;_.hljs]:text-inherit prose-img:rounded-lg prose-img:shadow-sm prose-img:max-w-[60%] prose-img:mx-auto [&amp;_img]:max-w-[60%] [&amp;_img]:mx-auto [&amp;_img]:block"><div><p><img src="/images/posts/dalle_files/firstdisplay.png" alt="png"></p>
<p>I explored the DALL-E 2 model API, in particular the image masking / in-painting functions. Most edits were not artistically compelling, but I find that leveraging simple combinatorial generation allows the creating of a more interesting semi-random collage.</p>
<p>The implementation demonstrates inpainting techniques through masked image editing, where specific spatial regions are reconstructed based on textual conditioning.</p>

<h3>Import Necessary Libaries and Define a Few Helper Functions</h3>
<pre><code class="hljs language-python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> openai
<span class="hljs-keyword">import</span> itertools
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> uuid
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
openai.api_key =  os.environ[<span class="hljs-string">"OPENAI_API_KEY"</span>]
openai.Model.<span class="hljs-built_in">list</span>()
<span class="hljs-comment"># Functions</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">ask_gpt</span>(<span class="hljs-params">prompt</span>):
    response = openai.Completion.create(
        engine=<span class="hljs-string">"text-davinci-003"</span>,  <span class="hljs-comment"># use the latest model available to you</span>
        prompt=prompt,
        max_tokens=<span class="hljs-number">200</span>, 
    )
    output_text_parsed = response.choices[<span class="hljs-number">0</span>].text.strip()
    <span class="hljs-built_in">print</span>(output_text_parsed)
    <span class="hljs-keyword">return</span> response
<span class="hljs-comment"># make a uniqueish string to label images as they are generated</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_uniqueish_string</span>():
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(uuid.uuid4())[:<span class="hljs-number">8</span>]

<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_dalle_images</span>(<span class="hljs-params">response, filename, image_dir, i, <span class="hljs-built_in">hash</span> = <span class="hljs-literal">True</span></span>):
    <span class="hljs-comment"># save the images</span>
    uid = generate_uniqueish_string()
    urls = [datum[<span class="hljs-string">"url"</span>] <span class="hljs-keyword">for</span> datum <span class="hljs-keyword">in</span> response[<span class="hljs-string">"data"</span>]]  <span class="hljs-comment"># extract URLs</span>
    images = [requests.get(url).content <span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> urls]  <span class="hljs-comment"># download images</span>
    image_names = [<span class="hljs-string">f"<span class="hljs-subst">{filename}</span>_<span class="hljs-subst">{i + <span class="hljs-number">1</span>}</span>_<span class="hljs-subst">{uid}</span>.png"</span> <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(images))]  <span class="hljs-comment"># create names</span>
    filepaths = [os.path.join(image_dir, name) <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> image_names]  <span class="hljs-comment"># create filepaths</span>
    <span class="hljs-keyword">for</span> image, filepath <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(images, filepaths):  <span class="hljs-comment"># loop through the variations</span>
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filepath, <span class="hljs-string">"wb"</span>) <span class="hljs-keyword">as</span> image_file:  <span class="hljs-comment"># open the file</span>
            image_file.write(image)  <span class="hljs-comment"># write the image to the file</span>

    <span class="hljs-keyword">return</span> filepaths
<span class="hljs-comment"># set a directory to save DALL·E images to</span>
image_dir_name = <span class="hljs-string">"images"</span>
image_dir = os.path.join(os.curdir, image_dir_name)

<span class="hljs-comment"># create the directory if it doesn't yet exist</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.isdir(image_dir):
    os.mkdir(image_dir)

<span class="hljs-comment"># print the directory to save to</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{image_dir=}</span>"</span>)
<span class="hljs-keyword">def</span> <span class="hljs-title function_">top_half_mask</span>(<span class="hljs-params">width, height, mask_dir, mask_name</span>):
    mask = Image.new(<span class="hljs-string">"RGBA"</span>, (width, height), (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>))
    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(width):
        <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(height // <span class="hljs-number">2</span>):
            mask.putpixel((x, y), (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))
    mask_filepath = os.path.join(mask_dir, mask_name)
    mask.save(mask_filepath)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">bottom_half_mask</span>(<span class="hljs-params">width, height, mask_dir, mask_name</span>):
    mask = Image.new(<span class="hljs-string">"RGBA"</span>, (width, height), (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>))
    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(width):
        <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(height // <span class="hljs-number">2</span>, height):
            mask.putpixel((x, y), (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))
    mask_filepath = os.path.join(mask_dir, mask_name)
    mask.save(mask_filepath)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">left_half_mask</span>(<span class="hljs-params">width, height, mask_dir, mask_name</span>):
    mask = Image.new(<span class="hljs-string">"RGBA"</span>, (width, height), (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>))
    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(width // <span class="hljs-number">2</span>):
        <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(height):
            mask.putpixel((x, y), (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))
    mask_filepath = os.path.join(mask_dir, mask_name)
    mask.save(mask_filepath)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">right_half_mask</span>(<span class="hljs-params">width, height, mask_dir, mask_name</span>):
    mask = Image.new(<span class="hljs-string">"RGBA"</span>, (width, height), (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>))
    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(width // <span class="hljs-number">2</span>, width):
        <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(height):
            mask.putpixel((x, y), (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))
    mask_filepath = os.path.join(mask_dir, mask_name)
    mask.save(mask_filepath)

</code></pre>
<pre><code>image_dir='./images'
</code></pre>
<h3>Show Image we are working with</h3>
<pre><code class="hljs language-python">american_gothic = <span class="hljs-string">"images/American_Gothic_Square.png"</span>
im = Image.<span class="hljs-built_in">open</span>(american_gothic)
display(im)
</code></pre>
<p><img src="/images/posts/dalle_files/dalle_3_0.png" alt="png"></p>
<h3>Leverage Large Language Models for Style Prompt Generation</h3>
<pre><code class="hljs language-python"><span class="hljs-comment"># Prompt engineering for art style enumeration via autoregressive language modeling</span>
question = <span class="hljs-string">"provide a python list of 15 distinct art styles (i.e. impressionist, cubist, pointlist, photorealistic, japanese wood block print)"</span>
<span class="hljs-comment"># Join the description and question into a single string</span>
prompt = <span class="hljs-string">f"<span class="hljs-subst">{question}</span>"</span>
gpt_output = ask_gpt(prompt)
<span class="hljs-comment"># Parse the output</span>
art_styles_string = gpt_output.choices[<span class="hljs-number">0</span>][<span class="hljs-string">'text'</span>]
art_styles = [line.split(<span class="hljs-string">'. '</span>)[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> art_styles_string.split(<span class="hljs-string">'\n'</span>) <span class="hljs-keyword">if</span> line]
<span class="hljs-comment"># choose the length of combinations you want, for example 2</span>
length_of_combinations = <span class="hljs-number">2</span>
style_combinations = <span class="hljs-built_in">list</span>(itertools.combinations(art_styles, length_of_combinations))
</code></pre>
<pre><code>1. Impressionism 
2. Cubism 
3. Pointillism 
4. Photorealism 
5. Japanese Wood Block Print 
6. Expressionism 
7. Constructivism 
8. Abstract Expressionism 
9. Surrealism 
10. Baroque 
11. Realism 
12. Neo-Impressionism 
13. Art Deco 
14. Cubo-Futurism 
15. Op Art
</code></pre>
<pre><code class="hljs language-python"><span class="hljs-comment"># Format the GPT output for Dalle prompt</span>
formatted_strings = []

<span class="hljs-keyword">for</span> combination <span class="hljs-keyword">in</span> style_combinations:
    style_1, style_2 = combination
    formatted_string = <span class="hljs-string">f"in the style of <span class="hljs-subst">{style_1}</span> and <span class="hljs-subst">{style_2}</span>"</span>
    formatted_strings.append(formatted_string)
<span class="hljs-comment"># TODO would be better to print at random from the list to actually show</span>
<span class="hljs-keyword">for</span> string <span class="hljs-keyword">in</span> formatted_strings[:<span class="hljs-number">10</span>]:
    <span class="hljs-built_in">print</span>(string)

</code></pre>
<pre><code>in the style of Impressionism  and Cubism .
in the style of Impressionism  and Pointillism .
in the style of Pointillism  and Surrealism .
in the style of Cubism  and Baroque .
</code></pre>
<h3>Create Masks</h3>
<pre><code class="hljs language-python">mask_dir = <span class="hljs-string">"images/masks"</span>
<span class="hljs-comment"># create the directory if it doesn't yet exist</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.isdir(mask_dir):
    os.mkdir(mask_dir)
<span class="hljs-comment"># print the directory to save to</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{mask_dir=}</span>"</span>)

<span class="hljs-comment"># TODO ask what are the actual image sizes </span>
width = <span class="hljs-number">574</span>
height = <span class="hljs-number">574</span>

mask_dir = <span class="hljs-string">"./masks"</span>
os.makedirs(mask_dir, exist_ok=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># ensure the directory exists</span>
top_half_mask(width, height, mask_dir, <span class="hljs-string">"top_half_mask.png"</span>)
bottom_half_mask(width, height, mask_dir, <span class="hljs-string">"bottom_half_mask.png"</span>)
left_half_mask(width, height, mask_dir, <span class="hljs-string">"left_half_mask.png"</span>)
right_half_mask(width, height, mask_dir, <span class="hljs-string">"right_half_mask.png"</span>)

<span class="hljs-comment"># specify edit images dir</span>
edit_image_dir = os.path.join(<span class="hljs-string">"images"</span>, <span class="hljs-string">"edits"</span>)
</code></pre>
<pre><code>mask_dir='images/masks'
</code></pre>
<pre><code class="hljs language-python">os.makedirs(<span class="hljs-string">f"<span class="hljs-subst">{edit_image_dir}</span>"</span>, exist_ok=<span class="hljs-literal">True</span>)
</code></pre>
<h3>Execute DALL-E 2 Inpainting with Stochastic Mask Selection and Style Conditioning</h3>
<pre><code class="hljs language-python"><span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> implement metadata embedding for tracking conditioning parameters in generated samples</span>

<span class="hljs-comment"># Specify the directory</span>
mask_dir = <span class="hljs-string">"./masks/"</span>
num_iterations = <span class="hljs-number">4</span>  <span class="hljs-comment"># specify the number of iterations</span>

<span class="hljs-comment"># Get the list of all masks in the directory</span>
masks = [f <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> os.listdir(mask_dir) <span class="hljs-keyword">if</span> f.endswith(<span class="hljs-string">'.png'</span>)]

<span class="hljs-comment"># Iterate for the number of specified iterations</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_iterations):
    <span class="hljs-comment"># Select a random mask</span>
    selected_mask = random.choice(masks)
    <span class="hljs-comment"># Get the full file path of the selected mask</span>
    mask_filepath = os.path.join(mask_dir, selected_mask)

    <span class="hljs-comment"># Select a random style combination</span>
    selected_prompt = random.choice(formatted_strings)

    <span class="hljs-comment"># Execute conditional image generation via masked inpainting</span>
    edit_response = openai.Image.create_edit(
        image=<span class="hljs-built_in">open</span>(american_gothic, <span class="hljs-string">"rb"</span>),  <span class="hljs-comment"># source image for conditioning</span>
        mask=<span class="hljs-built_in">open</span>(mask_filepath, <span class="hljs-string">"rb"</span>),  <span class="hljs-comment"># spatial mask for inpainting region</span>
        prompt=selected_prompt,  <span class="hljs-comment"># textual conditioning for style transfer</span>
        n=<span class="hljs-number">1</span>,  <span class="hljs-comment"># number of samples from posterior distribution</span>
        size=<span class="hljs-string">"512x512"</span>,  <span class="hljs-comment"># output resolution</span>
        response_format=<span class="hljs-string">"url"</span>,
    )
    
    <span class="hljs-comment"># print response for prototype / debug</span>
    <span class="hljs-comment"># print(edit_response)</span>
    edit_filepaths = process_dalle_images(edit_response, <span class="hljs-string">"edits"</span>, edit_image_dir, i, <span class="hljs-built_in">hash</span> = <span class="hljs-literal">True</span>)

</code></pre>
<h3>Visualization of Generated Sample Distribution via Grid Assembly</h3>
<pre><code class="hljs language-python"><span class="hljs-comment"># Specify the directory</span>
image_directory = <span class="hljs-string">"images/edits/"</span>
image_files = [f <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> os.listdir(image_directory) <span class="hljs-keyword">if</span> f.endswith(<span class="hljs-string">'.png'</span>)]
<span class="hljs-comment"># shuffle image file order to get different images in the plot</span>
image_files = np.random.permutation(image_files)
<span class="hljs-comment"># Load all the images</span>
images = [Image.<span class="hljs-built_in">open</span>(image_directory + f) <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> image_files]
<span class="hljs-comment"># Ensure sufficient samples for statistical visualization through repetition</span>
<span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(images) &#x3C; <span class="hljs-number">100</span>:
    images *= <span class="hljs-number">2</span>

<span class="hljs-comment"># Only take the first 100 images</span>
images = images[:<span class="hljs-number">100</span>]

<span class="hljs-comment"># Create a 10x10 visualization grid for sample distribution analysis</span>
fig, axes = plt.subplots(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>, figsize=(<span class="hljs-number">18</span>, <span class="hljs-number">18</span>))

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):
        <span class="hljs-comment"># Get the image</span>
        img = images[i * <span class="hljs-number">10</span> + j]

        <span class="hljs-comment"># Remove the axes for each subplot</span>
        axes[i, j].axis(<span class="hljs-string">'off'</span>)

        <span class="hljs-comment"># Display the image on the subplot</span>
        axes[i, j].imshow(np.array(img), aspect=<span class="hljs-string">'auto'</span>)

<span class="hljs-comment"># Adjust the space between the subplots</span>
<span class="hljs-comment"># Negative values for wspace and hspace will make the images overlap</span>
plt.subplots_adjust(wspace=-<span class="hljs-number">0.05</span>, hspace=-<span class="hljs-number">0.05</span>)

<span class="hljs-comment"># Show the plot</span>
plt.show()
</code></pre>
<p><img src="/images/posts/dalle_files/dalle_13_0.png" alt="png"></p></div></article><footer class="mt-12 pt-8 border-t"></footer></div></div><!--/$--><script src="/_next/static/chunks/webpack-e7e2e9d366afa4de.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[7555,[],\"\"]\n3:I[1295,[],\"\"]\n4:I[6874,[\"874\",\"static/chunks/874-f1885bdfe67c9a21.js\",\"858\",\"static/chunks/app/posts/%5Bslug%5D/page-f9e0a1a25b6c6997.js\"],\"\"]\n6:I[9665,[],\"OutletBoundary\"]\n9:I[9665,[],\"ViewportBoundary\"]\nb:I[9665,[],\"MetadataBoundary\"]\nd:I[6614,[],\"\"]\n:HL[\"/_next/static/media/558ca1a6aa3cb55e-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/a45cd71e868d0a07.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"AKR2_Vr3c5kOYgEpA2rhP\",\"p\":\"\",\"c\":[\"\",\"posts\",\"2023-05-24-dalle\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"2023-05-24-dalle\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/a45cd71e868d0a07.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_f9e569 antialiased font-mono bg-background text-foreground\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center justify-center min-h-screen p-4\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-4xl font-serif mb-4\",\"children\":\"404\"}],[\"$\",\"h2\",null,{\"className\":\"text-2xl mb-6\",\"children\":\"Page Not Found\"}],[\"$\",\"p\",null,{\"className\":\"mb-8 text-center\",\"children\":\"The page you are looking for doesn't exist or has been moved.\"}],[\"$\",\"$L4\",null,{\"href\":\"/\",\"className\":\"px-6 py-3 border border-neutral-200 hover:bg-primary/10 transition-colors\",\"children\":\"Return Home\"}]]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}],{\"children\":[\"posts\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"2023-05-24-dalle\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",\"$undefined\",null,[\"$\",\"$L6\",null,{\"children\":[\"$L7\",\"$L8\",null]}]]}],{},null,false]},null,false]},null,false]},[[\"$\",\"div\",\"l\",{\"className\":\"flex items-center justify-center min-h-screen\",\"children\":[\"$\",\"div\",null,{\"className\":\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary\"}]}],[],[]],false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"m3kUuJRG_1ZrpqFpw43vT\",{\"children\":[[\"$\",\"$L9\",null,{\"children\":\"$La\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],[\"$\",\"$Lb\",null,{\"children\":\"$Lc\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$d\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"e:T5b7,prose prose-lg max-w-none  prose-headings:font-serif prose-headings:font-semibold prose-headings:text-foreground prose-h1:text-3xl prose-h1:md:text-4xl prose-h1:mb-6 prose-h1:mt-8 prose-h2:text-2xl prose-h2:md:text-3xl prose-h2:mb-4 prose-h2:mt-8 prose-h3:text-xl prose-h3:md:text-2xl prose-h3:mb-3 prose-h3:mt-6 prose-p:text-base prose-p:md:text-lg prose-p:leading-relaxed prose-p:mb-6 prose-p:font-serif prose-p:text-muted-foreground prose-strong:font-semibold prose-strong:text-foreground prose-a:text-primary prose-a:no-underline hover:prose-a:underline prose-ul:mb-6 prose-ul:space-y-2 prose-li:text-base prose-li:md:text-lg prose-li:font-serif prose-li:text-muted-foreground prose-ol:mb-6 prose-ol:space-y-2 prose-blockquote:border-l-4 prose-blockquote:border-primary prose-blockquote:pl-4 prose-blockquote:italic prose-blockquote:text-muted-foreground prose-code:bg-[#fdf6e3] prose-code:text-[#657b83] prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-sm prose-code:font-mono prose-code:border prose-code:border-[#eee8d5] prose-pre:bg-[#fdf6e3] prose-pre:text-[#657b83] prose-pre:p-4 prose-pre:rounded-lg prose-pre:overflow-x-auto prose-pre:border prose-pre:border-[#eee8d5] prose-pre:shadow-sm prose-pre:font-mono prose-pre:text-sm prose-pre:leading-relaxed [\u0026_.hljs]:bg-transparent [\u0026_.hljs]:text-inherit prose-img:rounded-lg prose-img:shadow-sm prose-img:max-w-[60%] prose-img:mx-auto [\u0026_img]:max-w-[60%] [\u0026_img]:mx-auto [\u0026_img]:blockf:T4a47,"])</script><script>self.__next_f.push([1,"\u003cp\u003e\u003cimg src=\"/images/posts/dalle_files/firstdisplay.png\" alt=\"png\"\u003e\u003c/p\u003e\n\u003cp\u003eI explored the DALL-E 2 model API, in particular the image masking / in-painting functions. Most edits were not artistically compelling, but I find that leveraging simple combinatorial generation allows the creating of a more interesting semi-random collage.\u003c/p\u003e\n\u003cp\u003eThe implementation demonstrates inpainting techniques through masked image editing, where specific spatial regions are reconstructed based on textual conditioning.\u003c/p\u003e\n\n\u003ch3\u003eImport Necessary Libaries and Define a Few Helper Functions\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e os\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e openai\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e itertools\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e random\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e PIL \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e Image\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e requests\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e uuid\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e os\n\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e PIL \u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e Image\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e matplotlib.pyplot \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e plt\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e numpy \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e np\nopenai.api_key =  os.environ[\u003cspan class=\"hljs-string\"\u003e\"OPENAI_API_KEY\"\u003c/span\u003e]\nopenai.Model.\u003cspan class=\"hljs-built_in\"\u003elist\u003c/span\u003e()\n\u003cspan class=\"hljs-comment\"\u003e# Functions\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eask_gpt\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eprompt\u003c/span\u003e):\n    response = openai.Completion.create(\n        engine=\u003cspan class=\"hljs-string\"\u003e\"text-davinci-003\"\u003c/span\u003e,  \u003cspan class=\"hljs-comment\"\u003e# use the latest model available to you\u003c/span\u003e\n        prompt=prompt,\n        max_tokens=\u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e, \n    )\n    output_text_parsed = response.choices[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e].text.strip()\n    \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(output_text_parsed)\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e response\n\u003cspan class=\"hljs-comment\"\u003e# make a uniqueish string to label images as they are generated\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egenerate_uniqueish_string\u003c/span\u003e():\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003estr\u003c/span\u003e(uuid.uuid4())[:\u003cspan class=\"hljs-number\"\u003e8\u003c/span\u003e]\n\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eprocess_dalle_images\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eresponse, filename, image_dir, i, \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e = \u003cspan class=\"hljs-literal\"\u003eTrue\u003c/span\u003e\u003c/span\u003e):\n    \u003cspan class=\"hljs-comment\"\u003e# save the images\u003c/span\u003e\n    uid = generate_uniqueish_string()\n    urls = [datum[\u003cspan class=\"hljs-string\"\u003e\"url\"\u003c/span\u003e] \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e datum \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e response[\u003cspan class=\"hljs-string\"\u003e\"data\"\u003c/span\u003e]]  \u003cspan class=\"hljs-comment\"\u003e# extract URLs\u003c/span\u003e\n    images = [requests.get(url).content \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e url \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e urls]  \u003cspan class=\"hljs-comment\"\u003e# download images\u003c/span\u003e\n    image_names = [\u003cspan class=\"hljs-string\"\u003ef\"\u003cspan class=\"hljs-subst\"\u003e{filename}\u003c/span\u003e_\u003cspan class=\"hljs-subst\"\u003e{i + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e}\u003c/span\u003e_\u003cspan class=\"hljs-subst\"\u003e{uid}\u003c/span\u003e.png\"\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e j \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003erange\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003elen\u003c/span\u003e(images))]  \u003cspan class=\"hljs-comment\"\u003e# create names\u003c/span\u003e\n    filepaths = [os.path.join(image_dir, name) \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e name \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e image_names]  \u003cspan class=\"hljs-comment\"\u003e# create filepaths\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e image, filepath \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ezip\u003c/span\u003e(images, filepaths):  \u003cspan class=\"hljs-comment\"\u003e# loop through the variations\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003ewith\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e(filepath, \u003cspan class=\"hljs-string\"\u003e\"wb\"\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e image_file:  \u003cspan class=\"hljs-comment\"\u003e# open the file\u003c/span\u003e\n            image_file.write(image)  \u003cspan class=\"hljs-comment\"\u003e# write the image to the file\u003c/span\u003e\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e filepaths\n\u003cspan class=\"hljs-comment\"\u003e# set a directory to save DALL·E images to\u003c/span\u003e\nimage_dir_name = \u003cspan class=\"hljs-string\"\u003e\"images\"\u003c/span\u003e\nimage_dir = os.path.join(os.curdir, image_dir_name)\n\n\u003cspan class=\"hljs-comment\"\u003e# create the directory if it doesn't yet exist\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e os.path.isdir(image_dir):\n    os.mkdir(image_dir)\n\n\u003cspan class=\"hljs-comment\"\u003e# print the directory to save to\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003ef\"\u003cspan class=\"hljs-subst\"\u003e{image_dir=}\u003c/span\u003e\"\u003c/span\u003e)\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003etop_half_mask\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ewidth, height, mask_dir, mask_name\u003c/span\u003e):\n    mask = Image.new(\u003cspan class=\"hljs-string\"\u003e\"RGBA\"\u003c/span\u003e, (width, height), (\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e))\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e x \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003erange\u003c/span\u003e(width):\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e y \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003erange\u003c/span\u003e(height // \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e):\n            mask.putpixel((x, y), (\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e))\n    mask_filepath = os.path.join(mask_dir, mask_name)\n    mask.save(mask_filepath)\n\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ebottom_half_mask\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ewidth, height, mask_dir, mask_name\u003c/span\u003e):\n    mask = Image.new(\u003cspan class=\"hljs-string\"\u003e\"RGBA\"\u003c/span\u003e, (width, height), (\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e))\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e x \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003erange\u003c/span\u003e(width):\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e y \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003erange\u003c/span\u003e(height // \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, height):\n            mask.putpixel((x, y), (\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e))\n    mask_filepath = os.path.join(mask_dir, mask_name)\n    mask.save(mask_filepath)\n\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eleft_half_mask\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ewidth, height, mask_dir, mask_name\u003c/span\u003e):\n    mask = Image.new(\u003cspan class=\"hljs-string\"\u003e\"RGBA\"\u003c/span\u003e, (width, height), (\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e))\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e x \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003erange\u003c/span\u003e(width // \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e):\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e y \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003erange\u003c/span\u003e(height):\n            mask.putpixel((x, y), (\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e))\n    mask_filepath = os.path.join(mask_dir, mask_name)\n    mask.save(mask_filepath)\n\n\u003cspan class=\"hljs-keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eright_half_mask\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ewidth, height, mask_dir, mask_name\u003c/span\u003e):\n    mask = Image.new(\u003cspan class=\"hljs-string\"\u003e\"RGBA\"\u003c/span\u003e, (width, height), (\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e))\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e x \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003erange\u003c/span\u003e(width // \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e, width):\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e y \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003erange\u003c/span\u003e(height):\n            mask.putpixel((x, y), (\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e))\n    mask_filepath = os.path.join(mask_dir, mask_name)\n    mask.save(mask_filepath)\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode\u003eimage_dir='./images'\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eShow Image we are working with\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eamerican_gothic = \u003cspan class=\"hljs-string\"\u003e\"images/American_Gothic_Square.png\"\u003c/span\u003e\nim = Image.\u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e(american_gothic)\ndisplay(im)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/images/posts/dalle_files/dalle_3_0.png\" alt=\"png\"\u003e\u003c/p\u003e\n\u003ch3\u003eLeverage Large Language Models for Style Prompt Generation\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-comment\"\u003e# Prompt engineering for art style enumeration via autoregressive language modeling\u003c/span\u003e\nquestion = \u003cspan class=\"hljs-string\"\u003e\"provide a python list of 15 distinct art styles (i.e. impressionist, cubist, pointlist, photorealistic, japanese wood block print)\"\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# Join the description and question into a single string\u003c/span\u003e\nprompt = \u003cspan class=\"hljs-string\"\u003ef\"\u003cspan class=\"hljs-subst\"\u003e{question}\u003c/span\u003e\"\u003c/span\u003e\ngpt_output = ask_gpt(prompt)\n\u003cspan class=\"hljs-comment\"\u003e# Parse the output\u003c/span\u003e\nart_styles_string = gpt_output.choices[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e][\u003cspan class=\"hljs-string\"\u003e'text'\u003c/span\u003e]\nart_styles = [line.split(\u003cspan class=\"hljs-string\"\u003e'. '\u003c/span\u003e)[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e] \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e line \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e art_styles_string.split(\u003cspan class=\"hljs-string\"\u003e'\\n'\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e line]\n\u003cspan class=\"hljs-comment\"\u003e# choose the length of combinations you want, for example 2\u003c/span\u003e\nlength_of_combinations = \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\nstyle_combinations = \u003cspan class=\"hljs-built_in\"\u003elist\u003c/span\u003e(itertools.combinations(art_styles, length_of_combinations))\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode\u003e1. Impressionism \n2. Cubism \n3. Pointillism \n4. Photorealism \n5. Japanese Wood Block Print \n6. Expressionism \n7. Constructivism \n8. Abstract Expressionism \n9. Surrealism \n10. Baroque \n11. Realism \n12. Neo-Impressionism \n13. Art Deco \n14. Cubo-Futurism \n15. Op Art\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-comment\"\u003e# Format the GPT output for Dalle prompt\u003c/span\u003e\nformatted_strings = []\n\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e combination \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e style_combinations:\n    style_1, style_2 = combination\n    formatted_string = \u003cspan class=\"hljs-string\"\u003ef\"in the style of \u003cspan class=\"hljs-subst\"\u003e{style_1}\u003c/span\u003e and \u003cspan class=\"hljs-subst\"\u003e{style_2}\u003c/span\u003e\"\u003c/span\u003e\n    formatted_strings.append(formatted_string)\n\u003cspan class=\"hljs-comment\"\u003e# TODO would be better to print at random from the list to actually show\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e string \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e formatted_strings[:\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e]:\n    \u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(string)\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode\u003ein the style of Impressionism  and Cubism .\nin the style of Impressionism  and Pointillism .\nin the style of Pointillism  and Surrealism .\nin the style of Cubism  and Baroque .\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eCreate Masks\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003emask_dir = \u003cspan class=\"hljs-string\"\u003e\"images/masks\"\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# create the directory if it doesn't yet exist\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enot\u003c/span\u003e os.path.isdir(mask_dir):\n    os.mkdir(mask_dir)\n\u003cspan class=\"hljs-comment\"\u003e# print the directory to save to\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003eprint\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003ef\"\u003cspan class=\"hljs-subst\"\u003e{mask_dir=}\u003c/span\u003e\"\u003c/span\u003e)\n\n\u003cspan class=\"hljs-comment\"\u003e# TODO ask what are the actual image sizes \u003c/span\u003e\nwidth = \u003cspan class=\"hljs-number\"\u003e574\u003c/span\u003e\nheight = \u003cspan class=\"hljs-number\"\u003e574\u003c/span\u003e\n\nmask_dir = \u003cspan class=\"hljs-string\"\u003e\"./masks\"\u003c/span\u003e\nos.makedirs(mask_dir, exist_ok=\u003cspan class=\"hljs-literal\"\u003eTrue\u003c/span\u003e)  \u003cspan class=\"hljs-comment\"\u003e# ensure the directory exists\u003c/span\u003e\ntop_half_mask(width, height, mask_dir, \u003cspan class=\"hljs-string\"\u003e\"top_half_mask.png\"\u003c/span\u003e)\nbottom_half_mask(width, height, mask_dir, \u003cspan class=\"hljs-string\"\u003e\"bottom_half_mask.png\"\u003c/span\u003e)\nleft_half_mask(width, height, mask_dir, \u003cspan class=\"hljs-string\"\u003e\"left_half_mask.png\"\u003c/span\u003e)\nright_half_mask(width, height, mask_dir, \u003cspan class=\"hljs-string\"\u003e\"right_half_mask.png\"\u003c/span\u003e)\n\n\u003cspan class=\"hljs-comment\"\u003e# specify edit images dir\u003c/span\u003e\nedit_image_dir = os.path.join(\u003cspan class=\"hljs-string\"\u003e\"images\"\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\"edits\"\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode\u003emask_dir='images/masks'\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003eos.makedirs(\u003cspan class=\"hljs-string\"\u003ef\"\u003cspan class=\"hljs-subst\"\u003e{edit_image_dir}\u003c/span\u003e\"\u003c/span\u003e, exist_ok=\u003cspan class=\"hljs-literal\"\u003eTrue\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eExecute DALL-E 2 Inpainting with Stochastic Mask Selection and Style Conditioning\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-comment\"\u003e# \u003cspan class=\"hljs-doctag\"\u003eTODO:\u003c/span\u003e implement metadata embedding for tracking conditioning parameters in generated samples\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# Specify the directory\u003c/span\u003e\nmask_dir = \u003cspan class=\"hljs-string\"\u003e\"./masks/\"\u003c/span\u003e\nnum_iterations = \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e# specify the number of iterations\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# Get the list of all masks in the directory\u003c/span\u003e\nmasks = [f \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e f \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e os.listdir(mask_dir) \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e f.endswith(\u003cspan class=\"hljs-string\"\u003e'.png'\u003c/span\u003e)]\n\n\u003cspan class=\"hljs-comment\"\u003e# Iterate for the number of specified iterations\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003erange\u003c/span\u003e(num_iterations):\n    \u003cspan class=\"hljs-comment\"\u003e# Select a random mask\u003c/span\u003e\n    selected_mask = random.choice(masks)\n    \u003cspan class=\"hljs-comment\"\u003e# Get the full file path of the selected mask\u003c/span\u003e\n    mask_filepath = os.path.join(mask_dir, selected_mask)\n\n    \u003cspan class=\"hljs-comment\"\u003e# Select a random style combination\u003c/span\u003e\n    selected_prompt = random.choice(formatted_strings)\n\n    \u003cspan class=\"hljs-comment\"\u003e# Execute conditional image generation via masked inpainting\u003c/span\u003e\n    edit_response = openai.Image.create_edit(\n        image=\u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e(american_gothic, \u003cspan class=\"hljs-string\"\u003e\"rb\"\u003c/span\u003e),  \u003cspan class=\"hljs-comment\"\u003e# source image for conditioning\u003c/span\u003e\n        mask=\u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e(mask_filepath, \u003cspan class=\"hljs-string\"\u003e\"rb\"\u003c/span\u003e),  \u003cspan class=\"hljs-comment\"\u003e# spatial mask for inpainting region\u003c/span\u003e\n        prompt=selected_prompt,  \u003cspan class=\"hljs-comment\"\u003e# textual conditioning for style transfer\u003c/span\u003e\n        n=\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,  \u003cspan class=\"hljs-comment\"\u003e# number of samples from posterior distribution\u003c/span\u003e\n        size=\u003cspan class=\"hljs-string\"\u003e\"512x512\"\u003c/span\u003e,  \u003cspan class=\"hljs-comment\"\u003e# output resolution\u003c/span\u003e\n        response_format=\u003cspan class=\"hljs-string\"\u003e\"url\"\u003c/span\u003e,\n    )\n    \n    \u003cspan class=\"hljs-comment\"\u003e# print response for prototype / debug\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e# print(edit_response)\u003c/span\u003e\n    edit_filepaths = process_dalle_images(edit_response, \u003cspan class=\"hljs-string\"\u003e\"edits\"\u003c/span\u003e, edit_image_dir, i, \u003cspan class=\"hljs-built_in\"\u003ehash\u003c/span\u003e = \u003cspan class=\"hljs-literal\"\u003eTrue\u003c/span\u003e)\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eVisualization of Generated Sample Distribution via Grid Assembly\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-python\"\u003e\u003cspan class=\"hljs-comment\"\u003e# Specify the directory\u003c/span\u003e\nimage_directory = \u003cspan class=\"hljs-string\"\u003e\"images/edits/\"\u003c/span\u003e\nimage_files = [f \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e f \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e os.listdir(image_directory) \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e f.endswith(\u003cspan class=\"hljs-string\"\u003e'.png'\u003c/span\u003e)]\n\u003cspan class=\"hljs-comment\"\u003e# shuffle image file order to get different images in the plot\u003c/span\u003e\nimage_files = np.random.permutation(image_files)\n\u003cspan class=\"hljs-comment\"\u003e# Load all the images\u003c/span\u003e\nimages = [Image.\u003cspan class=\"hljs-built_in\"\u003eopen\u003c/span\u003e(image_directory + f) \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e f \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e image_files]\n\u003cspan class=\"hljs-comment\"\u003e# Ensure sufficient samples for statistical visualization through repetition\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003elen\u003c/span\u003e(images) \u0026#x3C; \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e:\n    images *= \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e# Only take the first 100 images\u003c/span\u003e\nimages = images[:\u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e]\n\n\u003cspan class=\"hljs-comment\"\u003e# Create a 10x10 visualization grid for sample distribution analysis\u003c/span\u003e\nfig, axes = plt.subplots(\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e, figsize=(\u003cspan class=\"hljs-number\"\u003e18\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e18\u003c/span\u003e))\n\n\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003erange\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e):\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e j \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003erange\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e):\n        \u003cspan class=\"hljs-comment\"\u003e# Get the image\u003c/span\u003e\n        img = images[i * \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e + j]\n\n        \u003cspan class=\"hljs-comment\"\u003e# Remove the axes for each subplot\u003c/span\u003e\n        axes[i, j].axis(\u003cspan class=\"hljs-string\"\u003e'off'\u003c/span\u003e)\n\n        \u003cspan class=\"hljs-comment\"\u003e# Display the image on the subplot\u003c/span\u003e\n        axes[i, j].imshow(np.array(img), aspect=\u003cspan class=\"hljs-string\"\u003e'auto'\u003c/span\u003e)\n\n\u003cspan class=\"hljs-comment\"\u003e# Adjust the space between the subplots\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# Negative values for wspace and hspace will make the images overlap\u003c/span\u003e\nplt.subplots_adjust(wspace=-\u003cspan class=\"hljs-number\"\u003e0.05\u003c/span\u003e, hspace=-\u003cspan class=\"hljs-number\"\u003e0.05\u003c/span\u003e)\n\n\u003cspan class=\"hljs-comment\"\u003e# Show the plot\u003c/span\u003e\nplt.show()\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/images/posts/dalle_files/dalle_13_0.png\" alt=\"png\"\u003e\u003c/p\u003e"])</script><script>self.__next_f.push([1,"5:[\"$\",\"div\",null,{\"className\":\"min-h-screen bg-background\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-4xl mx-auto px-6 py-12\",\"children\":[[\"$\",\"$L4\",null,{\"href\":\"/#posts\",\"className\":\"inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground mb-8 transition-colors\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":16,\"height\":16,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-arrow-left\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"path\",\"1l729n\",{\"d\":\"m12 19-7-7 7-7\"}],[\"$\",\"path\",\"x3x0zl\",{\"d\":\"M19 12H5\"}],\"$undefined\"]}],\"Back to posts\"]}],[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-4\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-sm uppercase text-muted-foreground mb-2\",\"children\":\"computer-vision\"}],[\"$\",\"h1\",null,{\"className\":\"text-4xl md:text-5xl font-serif font-bold leading-tight\",\"children\":\"DALL-E and a Combinatoric Collage\"}]]}],[\"$\",\"div\",null,{\"className\":\"text-muted-foreground\",\"children\":\"May 26, 2023\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap gap-2 mt-4\",\"children\":[[\"$\",\"span\",\"computer-vision\",{\"className\":\"px-2 py-1 text-xs bg-secondary text-secondary-foreground rounded\",\"children\":\"computer-vision\"}],[\"$\",\"span\",\"generative-modeling\",{\"className\":\"px-2 py-1 text-xs bg-secondary text-secondary-foreground rounded\",\"children\":\"generative-modeling\"}],[\"$\",\"span\",\"multimodal-ai\",{\"className\":\"px-2 py-1 text-xs bg-secondary text-secondary-foreground rounded\",\"children\":\"multimodal-ai\"}],[\"$\",\"span\",\"image-synthesis\",{\"className\":\"px-2 py-1 text-xs bg-secondary text-secondary-foreground rounded\",\"children\":\"image-synthesis\"}],[\"$\",\"span\",\"diffusion-models\",{\"className\":\"px-2 py-1 text-xs bg-secondary text-secondary-foreground rounded\",\"children\":\"diffusion-models\"}],[\"$\",\"span\",\"neural-networks\",{\"className\":\"px-2 py-1 text-xs bg-secondary text-secondary-foreground rounded\",\"children\":\"neural-networks\"}],[\"$\",\"span\",\"deep-learning\",{\"className\":\"px-2 py-1 text-xs bg-secondary text-secondary-foreground rounded\",\"children\":\"deep-learning\"}]]}]]}],[\"$\",\"article\",null,{\"className\":\"$e\",\"children\":[\"$\",\"div\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$f\"}}]}],[\"$\",\"footer\",null,{\"className\":\"mt-12 pt-8 border-t\"}]]}]}]\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n7:null\n"])</script><script>self.__next_f.push([1,"8:null\nc:[[\"$\",\"title\",\"0\",{\"children\":\"DALL-E and a Combinatoric Collage | Michael Swift\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"generative image model collages\"}],[\"$\",\"link\",\"2\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"128x128\"}]]\n"])</script></body></html>